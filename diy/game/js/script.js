var sad = "<svg class=\"sad\" width=\"44px\" height=\"44px\" viewBox=\"0 0 44 44\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n" +
    "                <g id=\"sad\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(0, 0)\">\n" +
    "                    <circle id=\"body\" fill=\"#E23D18\" cx=\"22\" cy=\"22\" r=\"22\"></circle>\n" +
    "                    <g id=\"face\" transform=\"translate(13.000000, 20.000000)\">\n" +
    "                        <g class=\"face\">\n" +
    "                            <path d=\"M7,4 C7,5.1045695 7.8954305,6 9,6 C10.1045695,6 11,5.1045695 11,4\" class=\"mouth\" stroke=\"#2C0E0F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(9.000000, 5.000000) rotate(-180.000000) translate(-9.000000, -5.000000) \"></path>\n" +
    "                            <ellipse class=\"right-eye\" fill=\"#2C0E0F\" cx=\"16.0941176\" cy=\"1.75609756\" rx=\"1.90588235\" ry=\"1.75609756\"></ellipse>\n" +
    "                            <ellipse class=\"left-eye\" fill=\"#2C0E0F\" cx=\"1.90588235\" cy=\"1.75609756\" rx=\"1.90588235\" ry=\"1.75609756\"></ellipse>\n" +
    "                        </g>\n" +
    "                    </g>\n" +
    "                </g>\n" +
    "            </svg>";

var neutral = "<svg class=\"neutral\" width=\"44px\" height=\"44px\" viewBox=\"0 0 44 44\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n" +
    "                <g>\n" +
    "                    <circle id=\"body\" fill=\"#F9AC1B\" cx=\"22\" cy=\"22\" r=\"22\"></circle>\n" +
    "                    <g class=\"face\">\n" +
    "                        <g transform=\"translate(13.000000, 20.000000)\" fill=\"#2C0E0F\">\n" +
    "                            <g class=\"mouth\">\n" +
    "                                <g transform=\"translate(9, 5)\" >\n" +
    "                                    <rect x=\"-2\" y=\"0\" width=\"4\" height=\"2\" rx=\"2\"></rect>\n" +
    "                                </g>\n" +
    "                            </g>\n" +
    "                            <ellipse class=\"right-eye\" cx=\"16.0941176\" cy=\"1.75\" rx=\"1.90588235\" ry=\"1.75\"></ellipse>\n" +
    "                            <ellipse class=\"left-eye\" cx=\"1.90588235\" cy=\"1.75\" rx=\"1.90588235\" ry=\"1.75\"></ellipse>\n" +
    "                        </g>\n" +
    "                    </g>\n" +
    "                </g>\n" +
    "            </svg>";

var fine = "<svg class=\"fine\" width=\"44px\" height=\"44px\" viewBox=\"0 0 44 44\" version=\"1.1\"\n" +
    "                 xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n" +
    "                <g id=\"fine-emotion\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n" +
    "                    <g id=\"fine\">\n" +
    "                        <circle id=\"body\" fill=\"#1988E3\" cx=\"22\" cy=\"22\" r=\"22\"></circle>\n" +
    "                        <g class=\"matrix\" transform=\"translate(22.000000, 32.000000)\">\n" +
    "                            <g class=\"face-container\">\n" +
    "                                <g class=\"face\" transform=\"translate(-9, -12)\">\n" +
    "                                    <g class=\"face-upAndDown\">\n" +
    "                                        <g class=\"eyes\">\n" +
    "                                            <ellipse class=\"right-eye\" fill=\"#2C0E0F\" cx=\"16.0941176\" cy=\"1.75609756\"\n" +
    "                                                     rx=\"1.90588235\" ry=\"1.75609756\"></ellipse>\n" +
    "                                            <ellipse class=\"left-eye\" fill=\"#2C0E0F\" cx=\"1.90588235\" cy=\"1.75609756\"\n" +
    "                                                     rx=\"1.90588235\" ry=\"1.75609756\"></ellipse>\n" +
    "                                        </g>\n" +
    "                                        <path d=\"M6.18823529,4.90499997 C6.18823529,5.95249999 7.48721095,7 9.08957864,7 C10.6919463,7 11.990922,5.95249999 11.990922,4.90499997\"\n" +
    "                                              id=\"mouth\" stroke=\"#2C0E0F\" stroke-linecap=\"round\"\n" +
    "                                              stroke-linejoin=\"round\"></path>\n" +
    "                                    </g>\n" +
    "                                </g>\n" +
    "                            </g>\n" +
    "                        </g>\n" +
    "                    </g>\n" +
    "                </g>\n" +
    "            </svg>";

var happy = "<svg class=\"happy\" width=\"44px\" height=\"44px\" viewBox=\"0 0 44 44\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n" +
    "                <g id=\"Happy\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(0, 0)\">\n" +
    "                    <circle id=\"Body\" fill=\"#248C37\" cx=\"22\" cy=\"22\" r=\"22\"></circle>\n" +
    "                    <g class=\"scaleFace\">\n" +
    "                        <g class=\"face\">\n" +
    "                            <ellipse id=\"Eye-right\" fill=\"#2C0E0F\" cx=\"29.0875\" cy=\"21.75\" rx=\"1.89926471\" ry=\"1.75\"></ellipse>\n" +
    "                            <ellipse id=\"Eye-left\" fill=\"#2C0E0F\" cx=\"14.8992647\" cy=\"21.75\" rx=\"1.89926471\" ry=\"1.75\"></ellipse>\n" +
    "                            <path d=\"M21.8941176,27.8819633 C24.8588235,27.8819632 25.4941176,25.5404999 25.4941176,24.5648901 C25.4941176,23.5892803 24.4352941,23.9795242 22.1058824,23.9795242 C19.7764706,23.9795242 18.2941176,23.5892803 18.2941176,24.5648901 C18.2941176,25.5404999 18.9294118,27.8819633 21.8941176,27.8819633 Z\" id=\"Mouth\" fill=\"#2C0E0F\"></path>\n" +
    "                            <ellipse id=\"Tung\" fill=\"#E23D18\" cx=\"21.8941176\" cy=\"26.4390244\" rx=\"1.69411765\" ry=\"0.780487805\"></ellipse>\n" +
    "                        </g>\n" +
    "                    </g>\n" +
    "            </svg>";

var faces = {sad: sad, neutral: neutral, fine: fine, happy:happy};
var places = [
    {top: "10px", left:"10px"},
    {top: "100px", left:"100px"},
    {top: "10px", left:"200px"},
    {top: "100px", left:"300px"},
    {top: "10px", left:"400px"},
    {top: "100px", left:"500px"},
    {top: "10px", left:"600px"},
    {top: "100px", left:"700px"},
    {top: "10px", left:"800px"}
];

function initGame() {
    var host = "ws://localhost:47401"; // SET THIS TO YOUR SERVER
    try {
        socket = new WebSocket(host);
        //log('WebSocket - status '+socket.readyState);
        socket.onopen    = function(msg) { console.log("olar"); };
        socket.onmessage = function(msg) {
            msg = JSON.parse(msg.data);

            if(msg.type == "changePlayer"){
                changeFace(msg.user, msg.message);
            }

            if(msg.type == "connected"){
                newPlayer(msg.message);
            }

            if(msg.type == "disconnected"){
                removePlayer(msg.message);
            }
        };
        socket.onclose   = function(msg) {  console.log("flw"); };
    } catch(ex){ log("chat", ex); }

}

function newPlayer(id){

    var player = document.createElement("div");

    player.innerHTML = "<div id='ballWrapper' class='bounce' style='top:"+places[0].top+"; left:"+places[0].left+";'><div id='"+ id +"'>" +
        "        <div></div>" +
        "        <div class='bloom'>" +
        "            <div class='sparkle'>" +
        "                <div class='sparkle-line'></div>" +
        "                <div class='sparkle-line'></div>" +
        "                <div class='sparkle-line'></div>" +
        "                <div class='sparkle-line'></div>" +
        "</div></div></div>";

    document.getElementById("allWrapper").appendChild(player);

    places.splice(0, 1)
    changeFace(id, "happy");
}

function removePlayer(id){
    var remove = document.getElementById(id);
    var pai = remove.parentNode;
    var avo = pai.parentNode;
    places.push({
        top:  pai.style.top,
        left: pai.style.left
    });

    document.getElementById('allWrapper').removeChild(avo);
}

function changeFace(player, face){
    document.getElementById(player).setAttribute("class", face);
    document.getElementById(player).innerHTML = faces[face];
    document.getElementById(player).children[0].setAttribute("class", face);
}

var socket;
function initChoose() {
    var host = "ws://localhost:47401"; // SET THIS TO YOUR SERVER
    try {
        socket = new WebSocket(host);
        //log('WebSocket - status '+socket.readyState);
        socket.onopen    = function(msg) { console.log("olar"); };
        socket.onmessage = function(msg) {
            msg = JSON.parse(msg.data);
            console.log(msg);
        };
        socket.onclose   = function(msg) {  console.log("flw"); };
    } catch(ex){ log("chat", ex); }

}

function changePlayer(face){
    console.log(face);
    socket.send('{"type": "changePlayer", "message": "'+face+'"}');
}

function quit(){
    if (socket != null) {
        socket.close();
        socket=null;
    }
}

function reconnect() {
    quit();
    init();
}